<div class="nav-container" [class.example-is-mobile]="mobileQuery.matches">
    <mat-toolbar color="primary" class="example-toolbar" style="justify-content: space-between; padding: 0px;"
        [style.height.px]="deviceSvc.topBar">
        <div style="display: flex;align-items: center;">
            <button mat-icon-button (click)="snav.toggle();" style="margin-top: -2px;">
                <mat-icon>{{snav.opened?'menu_open':'menu'}}</mat-icon>
            </button>
            <img *ngIf="avatar" mat-card-avatar [src]="avatar"
                style="height: 24px; width: 24px; margin-right: 8px; border-radius: 50%;" />
            <div style="font-size: 14px;"><span style="padding-right: 8px;">{{'WELCOME_MSG'|translate}}</span>{{name}}
            </div>
        </div>
        <div style="display: flex;">
            <div style="font-weight: 600; margin-top: 0px; display: flex; align-items: center; justify-content: center; cursor: pointer;"
                (click)="openDoc()">
                <div style="font-size: 16px;">{{'APP_DOC'|translate}}</div><mat-icon
                    style="padding-left:4px;font-size: 16px; width: 16px;height: 16px;">open_in_new</mat-icon>
            </div>
            <button mat-button [matMenuTriggerFor]="userMenu" (click)="userMsgSvc.clone()">
                <mat-icon matBadge="{{bellCount(userMsgSvc.latestMessage)}}" matBadgeOverlap="false"
                    matBadgeSize="small" matBadgeColor="accent">notifications_none
                </mat-icon>
            </button>
            <button *ngIf="hasAuth()" mat-button [matMenuTriggerFor]="menu" (click)="msgSvc.clone()">
                <mat-icon matBadge="{{bellCount(msgSvc.latestMessage)}}" matBadgeOverlap="false" matBadgeSize="small"
                    matBadgeColor="warn">notifications_none
                </mat-icon>
            </button>
        </div>
    </mat-toolbar>
    <mat-menu #menu="matMenu">
        <ng-container *ngIf="msgSvc.latestMessage.length===0">
            <div style="text-align: center;margin-top: 10px;">{{'NO_MSG'|translate}}</div>
        </ng-container>
        <ng-container *ngIf="msgSvc.latestMessage.length!==0">
            <ng-container *ngFor="let el of filterDuplicate(msgSvc.latestMessage); let i = index">
                <app-card-notification [value]="el" [length]="msgSvc.latestMessage.length" [index]="i"
                    (onAck)="msgSvc.dismiss($event)"></app-card-notification>
            </ng-container>
        </ng-container>
    </mat-menu>
    <mat-menu #userMenu="matMenu">
        <ng-container *ngIf="userMsgSvc.latestMessage.length===0">
            <div style="text-align: center;margin-top: 10px;">{{'NO_MSG'|translate}}</div>
        </ng-container>
        <ng-container *ngIf="userMsgSvc.latestMessage.length!==0">
            <ng-container *ngFor="let el of filterDuplicate(userMsgSvc.latestMessage); let i = index">
                <app-card-notification [value]="el" [length]="userMsgSvc.latestMessage.length" [index]="i"
                    (onAck)="userMsgSvc.dismiss($event)"></app-card-notification>
            </ng-container>
        </ng-container>
    </mat-menu>
    <mat-sidenav-container class="example-sidenav-container"
        [style.marginTop.px]="mobileQuery.matches ? deviceSvc.topBar : 0">
        <mat-sidenav #snav [mode]="mobileQuery.matches ? 'over' : 'side'" [fixedInViewport]="mobileQuery.matches"
            [opened]="navExpand('side_bar')" (opened)="openedHandler('side_bar')" (closed)="closedHander('side_bar')"
            [fixedTopGap]="deviceSvc.topBar" style="width: 256px;">
            <div *ngIf="projectSvc.viewProject" [formGroup]="switchProjectForm"  style="margin: 8px 8px 0 8px; height: 56px;">
                <!-- switch project select -->
                <mat-form-field>
                    <mat-label>{{'SWITCH_PROJECT'|translate}}</mat-label>
                    <mat-select formControlName="viewTenantId">
                        <mat-option *ngFor="let e of totalProjectsOptions" [value]="e.value">
                            {{e.label}}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
            </div>
            <mat-nav-list>
                <mat-list-item mat-list-item [routerLink]="nav.link" routerLinkActive="nav-active"
                    style="font-size: 14px;" [queryParams]="nav.params" *ngFor="let nav of menuTop">
                    <mat-icon style="padding-right:8px" *ngIf="nav.icon">{{nav.icon}}</mat-icon>{{nav.display|
                    translate}}
                </mat-list-item>
            </mat-nav-list>
            <mat-expansion-panel *ngIf="hasTenants()" (opened)="openedHandler('api_nav')"
                (closed)="closedHander('api_nav')" [expanded]="navExpand('api_nav')">
                <mat-expansion-panel-header>
                    <mat-panel-title style="font-weight: 600;">
                        {{'ENDPOINT_CENTER'| translate}}
                    </mat-panel-title>
                </mat-expansion-panel-header>
                <mat-nav-list>
                    <mat-list-item mat-list-item [routerLink]="nav.link" routerLinkActive="nav-active"
                        [preserveFragment]="true" style="font-size: 14px;" [queryParams]="preserveURLQueryParams(nav)"
                        *ngFor="let nav of menuEp">
                        <mat-icon style="padding-right:8px;">{{nav.icon}}</mat-icon>
                        {{nav.display| translate}}
                    </mat-list-item>
                </mat-nav-list>
            </mat-expansion-panel>
            <mat-expansion-panel (opened)="openedHandler('admin_nav')" (closed)="closedHander('admin_nav')"
                *ngIf="hasAuth()" [expanded]="navExpand('admin_nav')">
                <mat-expansion-panel-header>
                    <mat-panel-title style="font-weight: 600;">
                        {{'AUTH_CENTER'| translate}}
                    </mat-panel-title>
                </mat-expansion-panel-header>
                <mat-nav-list>
                    <mat-list-item mat-list-item [routerLink]="nav.link" routerLinkActive="nav-active"
                        [preserveFragment]="true" style="font-size: 14px;" [queryParams]="preserveURLQueryParams(nav)"
                        *ngFor="let nav of menuMgmt">
                        <mat-icon style="padding-right:8px;">{{nav.icon}}</mat-icon>
                        {{nav.display| translate}}
                    </mat-list-item>
                </mat-nav-list>
            </mat-expansion-panel>
            <mat-expansion-panel *ngIf="projectSvc.viewProject" (opened)="openedHandler(projectSvc.viewProject.id)"
                (closed)="closedHander(projectSvc.viewProject.id)" [expanded]="navExpand(projectSvc.viewProject.id)">
                <mat-expansion-panel-header>
                    <mat-panel-title style="font-weight: 600;">
                        {{projectSvc.viewProject.name}}
                    </mat-panel-title>
                </mat-expansion-panel-header>
                <mat-nav-list>
                    <ng-container *ngFor="let nav of menuTenant">
                        <mat-list-item mat-list-item [routerLink]="projectSvc.viewProject.id+'/'+nav.link"
                            routerLinkActive="nav-active" [preserveFragment]="true" style="font-size: 14px;"
                            [queryParams]="preserveURLQueryParams(nav)"
                            *appRequireP="getPermissionId(projectSvc.viewProject.id,nav.authName) | async">
                            <mat-icon style="padding-right:8px;">{{nav.icon}}</mat-icon>
                            {{nav.display| translate}}
                        </mat-list-item>
                    </ng-container>
                </mat-nav-list>
            </mat-expansion-panel>

            <mat-nav-list>
                <mat-list-item mat-list-item [routerLink]="nav.link" routerLinkActive="nav-active"
                    style="font-size: 14px;" [queryParams]="nav.params" *ngFor="let nav of menuMisc">
                    <mat-icon style="padding-right:8px">{{nav.icon}}</mat-icon>{{nav.display| translate}}
                </mat-list-item>
            </mat-nav-list>
            <mat-nav-list>
                <mat-list-item mat-list-item style="font-size: 14px;" (click)="doLogout()">
                    <mat-icon style="padding-right:8px">exit_to_app</mat-icon>{{'LOGOUT'| translate}}
                </mat-list-item>
            </mat-nav-list>
        </mat-sidenav>

        <mat-sidenav-content [style.padding-left.px]="mobileQuery.matches ? 15 : 30"
            [style.padding-right.px]="mobileQuery.matches ? 15 : 30">
            <router-outlet></router-outlet>
        </mat-sidenav-content>
    </mat-sidenav-container>
</div>